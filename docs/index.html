<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Notes</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Notes">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Notes" />
  
  
  



<meta name="date" content="2017-03-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  

<link rel="next" href="volsurf.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Unless otherwise stated,<br/>
all information here are<br/>
derived from public sources</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#basket"><i class="fa fa-check"></i><b>1.1</b> Basket</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#worstof"><i class="fa fa-check"></i><b>1.1.1</b> Worst-of</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#bestof"><i class="fa fa-check"></i><b>1.1.2</b> Best-of</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="volsurf.html"><a href="volsurf.html"><i class="fa fa-check"></i><b>2</b> Volatility Surface</a><ul>
<li class="chapter" data-level="2.1" data-path="volsurf.html"><a href="volsurf.html#implied-vol"><i class="fa fa-check"></i><b>2.1</b> Implied Vol</a></li>
<li class="chapter" data-level="2.2" data-path="volsurf.html"><a href="volsurf.html#local-vol"><i class="fa fa-check"></i><b>2.2</b> Local Vol</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="payoff.html"><a href="payoff.html"><i class="fa fa-check"></i><b>3</b> Payoff</a><ul>
<li class="chapter" data-level="3.1" data-path="payoff.html"><a href="payoff.html#noncallable"><i class="fa fa-check"></i><b>3.1</b> Noncallable</a><ul>
<li class="chapter" data-level="3.1.1" data-path="payoff.html"><a href="payoff.html#digitals"><i class="fa fa-check"></i><b>3.1.1</b> Digitals</a></li>
<li class="chapter" data-level="3.1.2" data-path="payoff.html"><a href="payoff.html#pdi"><i class="fa fa-check"></i><b>3.1.2</b> Put Down and In</a></li>
<li class="chapter" data-level="3.1.3" data-path="payoff.html"><a href="payoff.html#cuo"><i class="fa fa-check"></i><b>3.1.3</b> Call Up and Out</a></li>
<li class="chapter" data-level="3.1.4" data-path="payoff.html"><a href="payoff.html#combinations"><i class="fa fa-check"></i><b>3.1.4</b> Combinations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="payoff.html"><a href="payoff.html#callable"><i class="fa fa-check"></i><b>3.2</b> Callable</a><ul>
<li class="chapter" data-level="3.2.1" data-path="payoff.html"><a href="payoff.html#fcn"><i class="fa fa-check"></i><b>3.2.1</b> Fixed Coupon Autocallable</a></li>
<li class="chapter" data-level="3.2.2" data-path="payoff.html"><a href="payoff.html#apollon"><i class="fa fa-check"></i><b>3.2.2</b> Snowball Coupon Autocallable</a></li>
<li class="chapter" data-level="3.2.3" data-path="payoff.html"><a href="payoff.html#issuercallable"><i class="fa fa-check"></i><b>3.2.3</b> Issuercallable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sensi.html"><a href="sensi.html"><i class="fa fa-check"></i><b>4</b> Sensitivity</a><ul>
<li class="chapter" data-level="4.1" data-path="sensi.html"><a href="sensi.html#vol"><i class="fa fa-check"></i><b>4.1</b> Vol</a></li>
<li class="chapter" data-level="4.2" data-path="sensi.html"><a href="sensi.html#spot"><i class="fa fa-check"></i><b>4.2</b> Spot</a></li>
<li class="chapter" data-level="4.3" data-path="sensi.html"><a href="sensi.html#correl"><i class="fa fa-check"></i><b>4.3</b> Correl</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lsmc.html"><a href="lsmc.html"><i class="fa fa-check"></i><b>5</b> Longstaff Schwartz</a></li>
<li class="chapter" data-level="6" data-path="quirk.html"><a href="quirk.html"><i class="fa fa-check"></i><b>6</b> Quirkiness</a><ul>
<li class="chapter" data-level="6.1" data-path="quirk.html"><a href="quirk.html#inversion"><i class="fa fa-check"></i><b>6.1</b> Inversion</a><ul>
<li class="chapter" data-level="6.1.1" data-path="quirk.html"><a href="quirk.html#delta"><i class="fa fa-check"></i><b>6.1.1</b> Delta</a></li>
<li class="chapter" data-level="6.1.2" data-path="quirk.html"><a href="quirk.html#vega"><i class="fa fa-check"></i><b>6.1.2</b> Vega</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="quirk.html"><a href="quirk.html#gap"><i class="fa fa-check"></i><b>6.2</b> Gap</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="refer.html"><a href="refer.html"><i class="fa fa-check"></i><b>7</b> References</a><ul>
<li class="chapter" data-level="7.1" data-path="refer.html"><a href="refer.html#other-projects"><i class="fa fa-check"></i><b>7.1</b> Other projects</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="./">contact@ivanwj.com</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Notes</h1>
<h4 class="date"><em>2017-03-13</em></h4>
</div>
<div id="preface" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Preface</h1>
<p>In no-arbitrage pricing, one way of modelling a stock diffusion with constant drift and volatility terms is the geometric brownian motion model <a href="https://en.wikipedia.org/wiki/Geometric_Brownian_motion">(wiki)</a>:</p>
<p><span class="math display">\[S_T = S_0 \cdot  e^{\Big( r-d-q -\frac{1}{2}\sigma^2 \Big)\cdot T + \sigma \sqrt{T}\cdot W_T } \]</span></p>
<p>Given the market parameters one may simulate samples of spot at time <span class="math inline">\(T\)</span> as such:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aSampleSpotT =<span class="st"> </span>function(s0, r, d, q, sig, dt, nsims)
{
  sT =<span class="st"> </span>s0 *<span class="st"> </span><span class="kw">exp</span>((r -<span class="st"> </span>d -<span class="st"> </span>q -<span class="st"> </span><span class="fl">0.5</span> *<span class="st"> </span>sig^<span class="dv">2</span>)*dt +
<span class="st">                   </span>sig *<span class="st"> </span><span class="kw">rnorm</span>(nsims) *<span class="st"> </span><span class="kw">sqrt</span>(dt))
  sT
}
<span class="kw">cat</span>(<span class="st">&quot;Spot after 1 year: &quot;</span>, <span class="kw">aSampleSpotT</span>(<span class="dv">1</span>, <span class="fl">0.04</span>, <span class="fl">0.01</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>## Spot after 1 year:  0.9406981</code></pre>
<p>If required it is also possible to iterate over several consecutive periods to generate a path. For example, instead of sampling the spot after 1 year, we sample the spot after 1 week, then use the spot at week 1 to sample the spot at week 2, and so on until we arrive at the final observation as required. By repeatedly and independently generating many such paths we can visualise how the stock diffusion looks like.</p>
<p>Assume the stock drifts at 0% per annum, i.e. <span class="math inline">\(r - d - q = 0\)</span>, and the stock has constant volatility of 20% per annum, we plot several paths or trajectories. The initial spot price is normalised to 1. Each trajectory below consist of 52 consecutive weekly observations. See Figure <a href="index.html#fig:manyPath-compute-traj">1.1</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nSteps =<span class="st"> </span><span class="dv">52</span> <span class="co"># weekly obs</span>
aPath =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, nSteps<span class="dv">+1</span>) <span class="co"># initial spot is 1 </span>
for (i in <span class="dv">2</span>:(nSteps<span class="dv">+1</span>))
  aPath[i] =<span class="st"> </span><span class="kw">aSampleSpotT</span>(aPath[i<span class="dv">-1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>/nSteps, <span class="dv">1</span>)</code></pre></div>
<table>
<caption><span id="tab:onePath-compute-table">Table 1.1: </span>First 4 weekly close</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">week 1</th>
<th align="right">week 2</th>
<th align="right">week 3</th>
<th align="right">week 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Spot price</td>
<td align="right">1.010354</td>
<td align="right">1.008503</td>
<td align="right">1.027878</td>
<td align="right">1.046089</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(aPath, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,
     <span class="dt">axes =</span> F, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(manyTraj), <span class="kw">max</span>(manyTraj)))
<span class="kw">box</span>()
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)
<span class="kw">plot</span>(manyTraj[<span class="dv">1</span>,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,
     <span class="dt">axes =</span> F, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(manyTraj), <span class="kw">max</span>(manyTraj)))
<span class="kw">box</span>()
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)
for (i in <span class="dv">2</span>:<span class="kw">nrow</span>(manyTraj)) 
  <span class="kw">lines</span>(manyTraj[i,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:manyPath-compute-traj"></span>
<img src="book_files/figure-html/manyPath-compute-traj-1.png" alt="Left: 1 path, Right: 30 paths" width="80%" />
<p class="caption">
Figure 1.1: Left: 1 path, Right: 30 paths
</p>
</div>
<div id="basket" class="section level2">
<h2><span class="header-section-number">1.1</span> Basket</h2>
<p>Each of the 30 paths above can be thought as a different stock, so it could as well be one sample simulation of 30 different independent stocks prices after 1 year. However, when attempting to simulate <strong>several</strong> underlyings, it would not be unreasonable to consider the underlyings are actually correlated.</p>
<p>As an example we have a basket on three underlyings, with log returns of each underlying having pairwise correlation of 90%. See Table <a href="index.html#tab:basket-correl">1.2</a>.</p>
<p>The (multivariate) GBM process can be extended to underlyings that are correlated. Their correlations are preserved within the multivariate random portion of the process. <a href="https://en.wikipedia.org/wiki/Geometric_Brownian_motion">(wiki)</a></p>
<p>One way of generating a correlated multivariate random <span class="math inline">\(W_T\)</span> vector is to left-multiply a lower triangular Cholesky decomposed matrix to an uncorrelated multivariate random vector.<a href="https://en.wikipedia.org/wiki/Cholesky_decomposition#Monte_Carlo_simulation">(wiki)</a> <a href="http://math.stackexchange.com/questions/163470/generating-correlated-random-numbers-why-does-cholesky-decomposition-work">(math.SE)</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corrHigh =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">1.0</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span>, 
                <span class="fl">0.9</span>, <span class="fl">1.0</span>, <span class="fl">0.9</span>,
                <span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>), 
              <span class="dt">nrow =</span> <span class="dv">3</span>,
              <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;Undl 1&quot;</span>, <span class="st">&quot;Undl 2&quot;</span>, <span class="st">&quot;Undl 3&quot;</span>), 
                              <span class="kw">c</span>(<span class="st">&quot;Undl 1&quot;</span>, <span class="st">&quot;Undl 2&quot;</span>, <span class="st">&quot;Undl 3&quot;</span>)))</code></pre></div>
<table>
<caption><span id="tab:basket-correl">Table 1.2: </span>3 Highly Correlated Underlyings</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Undl 1</th>
<th align="right">Undl 2</th>
<th align="right">Undl 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Undl 1</td>
<td align="right">1.0</td>
<td align="right">0.9</td>
<td align="right">0.9</td>
</tr>
<tr class="even">
<td>Undl 2</td>
<td align="right">0.9</td>
<td align="right">1.0</td>
<td align="right">0.9</td>
</tr>
<tr class="odd">
<td>Undl 3</td>
<td align="right">0.9</td>
<td align="right">0.9</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use correlated random variables instead of independent ones</span>
corrSpot =<span class="st"> </span>function(s0, r, d, q, sig, dt, corrMat)
{
  nUndls =<span class="st"> </span><span class="kw">nrow</span>(corrMat)
  correlatedRV =<span class="st"> </span><span class="kw">as.double</span>(<span class="kw">t</span>(<span class="kw">chol</span>(corrMat)) %*%<span class="st"> </span><span class="kw">rnorm</span>(nUndls))
  sT =<span class="st"> </span>s0 *<span class="st"> </span><span class="kw">exp</span>((r -<span class="st"> </span>d -<span class="st"> </span>q -<span class="st"> </span><span class="fl">0.5</span> *<span class="st"> </span>sig^<span class="dv">2</span>)*dt +<span class="st"> </span>
<span class="st">                  </span>sig *<span class="st"> </span>correlatedRV *<span class="st"> </span><span class="kw">sqrt</span>(dt))
  sT
}

nUndls =<span class="st"> </span><span class="kw">nrow</span>(corrHigh)
nSteps =<span class="st"> </span><span class="dv">52</span> <span class="co"># weekly obs</span>

corrTraj =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, (nSteps<span class="dv">+1</span>)*nUndls), <span class="dt">nrow =</span> nUndls)
for (i in <span class="dv">2</span>:(nSteps<span class="dv">+1</span>))
  corrTraj[,i] =<span class="st"> </span><span class="kw">corrSpot</span>(corrTraj[,i<span class="dv">-1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>/nSteps, corrHigh)</code></pre></div>
<table>
<caption><span id="tab:manyTrajCorrelated-tab">Table 1.3: </span>First 4 weekly close of 3 correlated undls</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Week 1</th>
<th align="right">Week 2</th>
<th align="right">Week 3</th>
<th align="right">Week 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Undl 1</td>
<td align="right">1.0148149</td>
<td align="right">1.051679</td>
<td align="right">1.055015</td>
<td align="right">0.9982919</td>
</tr>
<tr class="even">
<td>Undl 2</td>
<td align="right">0.9873323</td>
<td align="right">1.018286</td>
<td align="right">1.025675</td>
<td align="right">0.9778886</td>
</tr>
<tr class="odd">
<td>Undl 3</td>
<td align="right">0.9844207</td>
<td align="right">1.040822</td>
<td align="right">1.033495</td>
<td align="right">0.9804207</td>
</tr>
</tbody>
</table>
<p>Sample paths of the underlyings. In black is underlying 1, in red underlying 2, in green underlying 3. See Figure <a href="index.html#fig:manyTrajCorrelated-traj">1.2</a>:</p>
<div class="figure" style="text-align: center"><span id="fig:manyTrajCorrelated-traj"></span>
<img src="book_files/figure-html/manyTrajCorrelated-traj-1.png" alt="Two separate simulations of the paths of the underlyings in the basket" width="80%" />
<p class="caption">
Figure 1.2: Two separate simulations of the paths of the underlyings in the basket
</p>
</div>
<div id="worstof" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Worst-of</h3>
<p>From a basket of underlyings, we could choose the lowest performing underlying and call it the worst-of underlying. Making this choice over the entire tenor of the product we can visual what a worst-of trajectory looks like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corrLow =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.1</span>, 
                <span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>,
                <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>), 
              <span class="dt">nrow =</span> <span class="dv">3</span>,
              <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;Undl 1&quot;</span>, <span class="st">&quot;Undl 2&quot;</span>, <span class="st">&quot;Undl 3&quot;</span>), 
                              <span class="kw">c</span>(<span class="st">&quot;Undl 1&quot;</span>, <span class="st">&quot;Undl 2&quot;</span>, <span class="st">&quot;Undl 3&quot;</span>)))

corrTraj2 =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, (nSteps<span class="dv">+1</span>)*nUndls), <span class="dt">nrow =</span> nUndls)
for (i in <span class="dv">2</span>:(nSteps<span class="dv">+1</span>))
  corrTraj2[,i] =<span class="st"> </span><span class="kw">corrSpot</span>(corrTraj2[,i<span class="dv">-1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.40</span>, <span class="dv">1</span>/nSteps, corrLow)</code></pre></div>
<p>To make it obvious that a worst-of “underlying” does not have to be the same underlying at different point of time, we chose to create a much lower correlated basket of underlyings. We also chose to fix the annualised volatility of these underlyings constant at 40%.</p>
<p>In this stylised result we see how the worst-of underlying may differ over time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(corrTraj2[,<span class="dv">2</span>:<span class="dv">5</span>]) <span class="co"># First 4 weekly close of 3 less correlated undls</span></code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]      [,4]
## [1,] 1.1135548 1.0202253 0.9835093 1.0333351
## [2,] 1.0472104 1.0016814 0.9452105 0.9230915
## [3,] 0.9400727 0.8563856 0.8384821 0.8305874</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">woTraj =<span class="st"> </span><span class="kw">apply</span>(corrTraj2, <span class="dv">2</span>, min)
<span class="kw">print</span>(woTraj[<span class="dv">2</span>:<span class="dv">5</span>]) <span class="co"># First 4 weekly close of the worst &quot;underlying&quot;</span></code></pre></div>
<pre><code>## [1] 0.9400727 0.8563856 0.8384821 0.8305874</code></pre>
<p>Let’s plot one sample of all underlying paths. On the right we overlay the worst-of “underlying” in blue while greying out the actual underlying paths. See Figure <a href="index.html#fig:wo-traj-plot">1.3</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(corrTraj2[<span class="dv">1</span>,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,
     <span class="dt">axes =</span> F, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(corrTraj2), <span class="kw">max</span>(corrTraj2)))
<span class="kw">box</span>()
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)
for (i in <span class="dv">2</span>:<span class="kw">nrow</span>(corrTraj2)) 
  <span class="kw">lines</span>(corrTraj2[i,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> basketCols[i])

<span class="kw">plot</span>(corrTraj2[<span class="dv">1</span>,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,
     <span class="dt">axes =</span> F, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;azure3&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(corrTraj2), <span class="kw">max</span>(corrTraj2)))
<span class="kw">box</span>()
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)
for (i in <span class="dv">2</span>:<span class="kw">nrow</span>(corrTraj2)) 
  <span class="kw">lines</span>(corrTraj2[i,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,  <span class="dt">col =</span> <span class="st">&quot;azure3&quot;</span>)
<span class="kw">lines</span>(woTraj, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:wo-traj-plot"></span>
<img src="book_files/figure-html/wo-traj-plot-1.png" alt="A basket of 3 underlyings (in grey) and the worst-of underlying (in blue)" width="672" />
<p class="caption">
Figure 1.3: A basket of 3 underlyings (in grey) and the worst-of underlying (in blue)
</p>
</div>
<p>A relevant question is why anyone would want to buy a call option that tracks the worst performance instead of the average performance, since the alternative is very likely to pay more at maturity. The sensible answer is that if the investor has a bullish view on the entire basket, buying a worst-of call option is <em>a lot</em> more affordable than buying a call that is based on the average performance. As we’ll see in Chapter <a href="payoff.html#payoff">3</a>, this makes possible some interesting exotic payoffs.</p>
</div>
<div id="bestof" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Best-of</h3>
<p>Having seen a worst-of <em>underlying</em>, there is no reason why we cannot have a best-of version.</p>
<p>Unlike the worst-of call option, a best-of call is more expensive than the average of call. However, if you have a bearish view, buying a best-of put is much more affordable. Likewise, <em>selling</em> a best-of call brings the investor much more premium.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(corrTraj2[,<span class="dv">1</span>:<span class="dv">5</span>]) <span class="co"># First 5 weekly close of 3 correlated undls</span></code></pre></div>
<pre><code>##      [,1]      [,2]      [,3]      [,4]      [,5]
## [1,]    1 1.1135548 1.0202253 0.9835093 1.0333351
## [2,]    1 1.0472104 1.0016814 0.9452105 0.9230915
## [3,]    1 0.9400727 0.8563856 0.8384821 0.8305874</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boTraj =<span class="st"> </span><span class="kw">apply</span>(corrTraj2, <span class="dv">2</span>, max)
<span class="kw">print</span>(woTraj[<span class="dv">1</span>:<span class="dv">5</span>]) <span class="co"># First 5 weekly close of the worst &quot;underlying&quot;</span></code></pre></div>
<pre><code>## [1] 1.0000000 0.9400727 0.8563856 0.8384821 0.8305874</code></pre>
<p>Again, we see there is no need for the best-of “underlying” to be the same underlying in the basket from start to end of the product tenor. See Figure <a href="index.html#fig:bo-traj-plot">1.4</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(corrTraj2[<span class="dv">1</span>,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,
     <span class="dt">axes =</span> F, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(corrTraj2), <span class="kw">max</span>(corrTraj2)))
<span class="kw">box</span>()
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)
for (i in <span class="dv">2</span>:<span class="kw">nrow</span>(corrTraj2)) 
  <span class="kw">lines</span>(corrTraj2[i,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> basketCols[i])

<span class="kw">plot</span>(corrTraj2[<span class="dv">1</span>,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;azure3&quot;</span>,
     <span class="dt">axes =</span> F, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(corrTraj2), <span class="kw">max</span>(corrTraj2)))
<span class="kw">box</span>()
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)
for (i in <span class="dv">2</span>:<span class="kw">nrow</span>(corrTraj2)) 
  <span class="kw">lines</span>(corrTraj2[i,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;azure3&quot;</span>)
<span class="kw">lines</span>(boTraj, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:bo-traj-plot"></span>
<img src="book_files/figure-html/bo-traj-plot-1.png" alt="A basket of 3 underlyings (in grey) and the best-of underlying (in blue)" width="672" />
<p class="caption">
Figure 1.4: A basket of 3 underlyings (in grey) and the best-of underlying (in blue)
</p>
</div>
<p>Now we repeat the over many simulations of the 3 underlyings paths. On the right we overlay in blue the best-of “underlying” of each simulation.</p>
<p><img src="book_files/figure-html/bo-traj-simplot-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="volsurf.html" class="navigation navigation-next navigation-unique" aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": ["book.pdf", "book.mobi"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
