<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Notes</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Notes">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Notes" />
  
  
  

<meta name="author" content="Ivan Tan">


<meta name="date" content="2017-03-06">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="volsurf.html">
<link rel="next" href="sensi.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Diffusion</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#basket"><i class="fa fa-check"></i><b>1.1</b> Basket</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#worstof"><i class="fa fa-check"></i><b>1.2</b> Worst-of</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#bestof"><i class="fa fa-check"></i><b>1.3</b> Best-of</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="volsurf.html"><a href="volsurf.html"><i class="fa fa-check"></i><b>2</b> Volatility Surface</a><ul>
<li class="chapter" data-level="2.1" data-path="volsurf.html"><a href="volsurf.html#implied-vol-surface"><i class="fa fa-check"></i><b>2.1</b> Implied vol surface</a></li>
<li class="chapter" data-level="2.2" data-path="volsurf.html"><a href="volsurf.html#local-vol-surface"><i class="fa fa-check"></i><b>2.2</b> Local vol surface</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="payoff.html"><a href="payoff.html"><i class="fa fa-check"></i><b>3</b> Payoff</a><ul>
<li class="chapter" data-level="3.1" data-path="payoff.html"><a href="payoff.html#noncallable"><i class="fa fa-check"></i><b>3.1</b> Noncallable</a><ul>
<li class="chapter" data-level="3.1.1" data-path="payoff.html"><a href="payoff.html#digitals"><i class="fa fa-check"></i><b>3.1.1</b> Digitals</a></li>
<li class="chapter" data-level="3.1.2" data-path="payoff.html"><a href="payoff.html#pdi"><i class="fa fa-check"></i><b>3.1.2</b> Put Down and In</a></li>
<li class="chapter" data-level="3.1.3" data-path="payoff.html"><a href="payoff.html#cuo"><i class="fa fa-check"></i><b>3.1.3</b> Call Up and Out</a></li>
<li class="chapter" data-level="3.1.4" data-path="payoff.html"><a href="payoff.html#combinations"><i class="fa fa-check"></i><b>3.1.4</b> Combinations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="payoff.html"><a href="payoff.html#autocallable"><i class="fa fa-check"></i><b>3.2</b> Autocallable</a><ul>
<li class="chapter" data-level="3.2.1" data-path="payoff.html"><a href="payoff.html#apollon"><i class="fa fa-check"></i><b>3.2.1</b> Snowball</a></li>
<li class="chapter" data-level="3.2.2" data-path="payoff.html"><a href="payoff.html#phoenix"><i class="fa fa-check"></i><b>3.2.2</b> Phoenix</a></li>
<li class="chapter" data-level="3.2.3" data-path="payoff.html"><a href="payoff.html#fcn"><i class="fa fa-check"></i><b>3.2.3</b> Fixed Coupons Notes</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="payoff.html"><a href="payoff.html#issuercallable"><i class="fa fa-check"></i><b>3.3</b> Issuercallable</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sensi.html"><a href="sensi.html"><i class="fa fa-check"></i><b>4</b> Sensitivity</a><ul>
<li class="chapter" data-level="4.1" data-path="sensi.html"><a href="sensi.html#vol"><i class="fa fa-check"></i><b>4.1</b> Vol</a></li>
<li class="chapter" data-level="4.2" data-path="sensi.html"><a href="sensi.html#correl"><i class="fa fa-check"></i><b>4.2</b> Correl</a></li>
<li class="chapter" data-level="4.3" data-path="sensi.html"><a href="sensi.html#drift"><i class="fa fa-check"></i><b>4.3</b> Drift</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lsmc.html"><a href="lsmc.html"><i class="fa fa-check"></i><b>5</b> Longstaff Schwartz</a></li>
<li class="chapter" data-level="6" data-path="scen.html"><a href="scen.html"><i class="fa fa-check"></i><b>6</b> Scenario</a></li>
<li class="chapter" data-level="7" data-path="quirk.html"><a href="quirk.html"><i class="fa fa-check"></i><b>7</b> Quirkiness</a><ul>
<li class="chapter" data-level="7.1" data-path="quirk.html"><a href="quirk.html#inversion"><i class="fa fa-check"></i><b>7.1</b> Inversion</a><ul>
<li class="chapter" data-level="7.1.1" data-path="quirk.html"><a href="quirk.html#delta"><i class="fa fa-check"></i><b>7.1.1</b> Delta</a></li>
<li class="chapter" data-level="7.1.2" data-path="quirk.html"><a href="quirk.html#vega"><i class="fa fa-check"></i><b>7.1.2</b> Vega</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="quirk.html"><a href="quirk.html#gap"><i class="fa fa-check"></i><b>7.2</b> Gap</a></li>
<li class="chapter" data-level="7.3" data-path="quirk.html"><a href="quirk.html#qto"><i class="fa fa-check"></i><b>7.3</b> Qto</a></li>
<li class="chapter" data-level="7.4" data-path="quirk.html"><a href="quirk.html#correl-1"><i class="fa fa-check"></i><b>7.4</b> Correl</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="refer.html"><a href="refer.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
<li class="divider"></li>
<li><a href="./">Unless otherwise stated,<br/>
all information here are<br/>
derived from public sources</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="payoff" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Payoff</h1>
<p>From the diffusions created in Chapter <a href="index.html#diffuse">1</a>, we could evaluate them based on the payoff of the product. To start off we price a vanilla call option, then compare the result with the closed-form Black Scholes solution.</p>
<p>For a 1 year european call option strike at the money on an underlying with zero drift and constant 20% annualised volatility, we see the stimulations gave a price of about 8%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">strikeK =<span class="st"> </span><span class="dv">1</span>
diffusions =<span class="st">  </span><span class="kw">aSampleSpotT</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">50000</span>)
payoffs =<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, diffusions -<span class="st"> </span>strikeK)
<span class="kw">mean</span>(payoffs)</code></pre></div>
<pre><code>## [1] 0.08003388</code></pre>
<p>Comparing the result to the Black Scholes solution:</p>
<p><span class="math display">\[
    \mathrm C(\mathrm S,\mathrm t)= \mathrm N(\mathrm d_1)\mathrm S - \mathrm N(\mathrm d_2) \mathrm K \mathrm e^{-rt}
    \label{eq:2}
\]</span></p>
<p>where <span class="math inline">\(d_1\)</span>, <span class="math inline">\(d_2\)</span> and <span class="math inline">\(N(x)\)</span> is defined as:</p>
<p><span class="math display">\[
\mathrm d_1= \frac{1}{\sigma \sqrt{\mathrm t}} \left[\ln{\left(\frac{S}{K}\right)} + t\left(r + \frac{\sigma^2}{2} \right) \right]
\]</span></p>
<p><span class="math display">\[
\mathrm d_2= \frac{1}{\sigma \sqrt{\mathrm t}} \left[\ln{\left(\frac{S}{K}\right)} + t\left(r - \frac{\sigma^2}{2} \right) \right]
\]</span></p>
<p><span class="math display">\[
    N(x)=\frac{1}{\sqrt{2\pi}} \int_{-\infty}^{x} \mathrm e^{-\frac{1}{2}z^2} dz
    \label{eq:5}
\]</span></p>
<p>Now substituting in the values:</p>
<p><span class="math display">\[
\mathrm d_1= \frac{1}{0.2 \sqrt{1}} \left[\ln{\left(\frac{1}{1}\right)} + 1\left(0 + \frac{0.2^2}{2} \right) \right]= 0.1
\]</span> <span class="math display">\[
\mathrm d_1= \frac{1}{0.2 \sqrt{1}} \left[\ln{\left(\frac{1}{1}\right)} + 1\left(0 - \frac{0.2^2}{2} \right) \right]=-0.1
\]</span></p>
<p><span class="math display">\[
N(d_1)=N(0.1)=\frac{1}{\sqrt{2\pi}} \int_{-\infty}^{0.1} \mathrm e^{-\frac{1}{2}z^2} dz = 0.5398
\]</span> <span class="math display">\[
N(d_2)=N(-0.1)=\frac{1}{\sqrt{2\pi}} \int_{-\infty}^{-.1} \mathrm e^{-\frac{1}{2}z^2} dz = 0.4602
\]</span></p>
<p><span class="math display">\[
\mathrm C(1,1)= (0.5398)(1) - (0.4602)(1) \mathrm e^{-(0)(1)} \approx 0.0796
\]</span></p>
<p>Good start! Rates, dividends and repo are assumed to be zero. Also that volatility is constant. We could do better by incorporating changes to these assumptions in later chapters.</p>
<p>Up till this point our monte carlo simulations used random normal deviates that mimic randomness from the <code>R</code> function <code>rnorm</code>. Had we prefer our simulations to done by quasi- monte carlo, we will want to use <em>low-discrepancy</em> sequences instead of random numbers. The <code>R</code> function <code>sobol</code> from library <code>randtoolbox</code> provides such number generation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(randtoolbox)
aSampleSpotT_QMC =<span class="st"> </span>function(s0, r, d, q, sig, dt, nsims)
{
  sT =<span class="st"> </span>s0 *<span class="st"> </span><span class="kw">exp</span>((r -<span class="st"> </span>d -<span class="st"> </span>q -<span class="st"> </span><span class="fl">0.5</span> *<span class="st"> </span>sig^<span class="dv">2</span>)*dt +
<span class="st">                   </span>sig *<span class="st"> </span><span class="kw">sobol</span>(nsims, <span class="dt">normal =</span> <span class="ot">TRUE</span>) *<span class="st"> </span><span class="kw">sqrt</span>(dt))
  sT
}

diffusions_QMC =<span class="st">  </span><span class="kw">aSampleSpotT_QMC</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">10000</span>)
payoffs_QMC =<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, diffusions_QMC -<span class="st"> </span>strikeK)
<span class="kw">mean</span>(payoffs_QMC)</code></pre></div>
<pre><code>## [1] 0.07958281</code></pre>
<p>We see the results are very similar and expect lower variance compare to ordinary monte carlo simulations.</p>
<div id="noncallable" class="section level2">
<h2><span class="header-section-number">3.1</span> Noncallable</h2>
<p>Non-callable payoffs are structures that have a fixed maturity. Structure that have possible earlier redemption or termination than this fixed maturity are called callable payoffs.</p>
<div id="digitals" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Digitals</h3>
<p>An example of a digit is one that pays X at maturity when the underlying is at or above a certain barrier, and pays nothing when the underlying is below, it is also called a <em>up and in</em> digit option. There are also versions; an <em>up and out</em> digit which the structure pays X unless the underlying is at or above a certain barrier, a <em>down and in</em> digit is equivalent to the <em>up and out</em> digit, and a <em>down and out</em> digit which is the same as a <em>up and in</em> digit.</p>
<p>There are also variants of when the knocking in or out observation is carried out. A common type is called the <em>European</em> (or at maturity) observation which checks if the condition is satisfied only once at end of the product tenor. <em>American</em> observation type is as common, which checks for the condition on a daily close frequency. Other variants include quarterly, monthly or intraday observation frequency.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
numTraj_digit =<span class="st"> </span><span class="dv">2</span>
manyTraj_digit =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, numSteps*numTraj_digit), <span class="dt">nrow =</span> numTraj_digit)
for (i in <span class="dv">2</span>:numSteps)
  manyTraj_digit[,i] =<span class="st"> </span><span class="kw">aSampleSpotT</span>(manyTraj_digit[,i<span class="dv">-1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>/numSteps, numTraj_digit)</code></pre></div>
<p>Supposed we have bought two 1 year european <em>up and in</em> digit 10% with barrier striked at 110% on same underlying above. Two sample trajectories below show that path 1 performed +26%, while path 2 only ended up +1%. According to the payoff, the first product will pay a 10% payout while the second product does not. See Figure <a href="payoff.html#fig:digit-plot">3.1</a>:</p>
<pre><code>## Closing price at end of Year 1 for Path 1:  1.264054</code></pre>
<pre><code>## Closing price at end of Year 1 for Path 2:  1.012484</code></pre>
<div class="figure" style="text-align: center"><span id="fig:digit-plot"></span>
<img src="bookdown-demo_files/figure-html/digit-plot-1.png" alt="2 separate trajectories; Left path ends below the strike and receives a 10% payout, the right path does not pay any. Blue line denotes the strike barrier at 110% of initial spot." width="80%" />
<p class="caption">
Figure 3.1: 2 separate trajectories; Left path ends below the strike and receives a 10% payout, the right path does not pay any. Blue line denotes the strike barrier at 110% of initial spot.
</p>
</div>
<p>Pricing this payoff is similar to that of a call option, except when the option is in the money, it pays the digit coupon instead of the performance of the underlying minus its strike. We see it cost about 3%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">digitK =<span class="st"> </span><span class="fl">1.1</span>
digitCpn =<span class="st"> </span><span class="fl">0.1</span>
digitPays =<span class="st"> </span>(diffusions &gt;<span class="st"> </span>digitK)*digitCpn
<span class="kw">mean</span>(digitPays)</code></pre></div>
<pre><code>## [1] 0.028316</code></pre>
</div>
<div id="pdi" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Put Down and In</h3>
<p>Like the digital <em>down and in</em> option above, a <em>put down and in</em> option knocks in when an underlying ends below a certain barrier. However, when the condition is satisfied, the put comes into existence and so the payoff is that of a vanilla put option. We therefore need to be given the put strike in order to determine the payoff.</p>
<p>Let’s say we <strong>sell</strong> a 1y <em>put down and in</em> on the same underlying as before, with european (at maturity) down and in barrier 80% and put strike 100%. For a change of pace we proceed to the price before visualising what a sample path and its payoff is.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdiK =<span class="st"> </span><span class="dv">1</span>
eki80Barrier =<span class="st"> </span><span class="fl">0.8</span>
pdi80Hit =<span class="st"> </span>diffusions &lt;=<span class="st"> </span>eki80Barrier
putPays =<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, pdiK -<span class="st"> </span>diffusions)
pdi80Pays =<span class="st"> </span>putPays*<span class="kw">as.double</span>(pdi80Hit)
<span class="kw">mean</span>(-<span class="dv">1</span> *<span class="st"> </span>pdi80Pays) <span class="co"># price of short pdi with eki = 80% and strike = 100%</span></code></pre></div>
<pre><code>## [1] -0.04257575</code></pre>
<p>We will use the convention of a negative premium for investor <strong>receiving</strong> the premium instead of paying the premium.</p>
<p>If we think of the knock-in feature on a short put as <em>protection</em>, that is the option seller sold a put that will not be in the money unless the underlying has first broken the knock in barrier, then we should expect a <em>put down and in</em> with european barrier at 80% to bring less value than one with barrier at 90%. Both of which has to be cheaper than a straight put, or a put without knock-in feature.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdi_comparison =<span class="st"> </span><span class="kw">c</span>(<span class="kw">mean</span>(-<span class="dv">1</span> *<span class="st"> </span>pdi80Pays), <span class="kw">mean</span>(-<span class="dv">1</span> *<span class="st"> </span>pdi90Pays), <span class="kw">mean</span>(-<span class="dv">1</span> *<span class="st"> </span>putPays))
pdi_comparison</code></pre></div>
<pre><code>## [1] -0.04257575 -0.06940946 -0.07956403</code></pre>
<p>We see the seller of the different puts receives more if he sold a <em>put down and in</em> with higher knock-in barrier, or when there is no barrier (a put). Looking consistent!</p>
<p>By the same argument, a <em>put down and in</em> with american (daily close) knock-in observation type costs more than the european type, since there are more opportunities for the product to be knocked in. We delay this comparison on observation frequency to the next section.</p>
<p>In structured products, puts with knock-in features are very common, since they provide some protection for the investors unless the underlying has severely underperformed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">8</span>)
numTraj_pdi =<span class="st"> </span><span class="dv">2</span>
manyTraj_pdi =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, numSteps*numTraj_pdi), <span class="dt">nrow =</span> numTraj_pdi)
for (i in <span class="dv">2</span>:numSteps)
    manyTraj_pdi[,i] =<span class="st"> </span><span class="kw">aSampleSpotT</span>(manyTraj_pdi[,i<span class="dv">-1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">1</span>/numSteps, numTraj_digit)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pdi-plot"></span>
<img src="bookdown-demo_files/figure-html/pdi-plot-1.png" alt="2 separate trajectories; Left: Path is not below the KI barrier, so has no value even though it is below the strike. Right: Path ends below KI barrier." width="80%" />
<p class="caption">
Figure 3.2: 2 separate trajectories; Left: Path is not below the KI barrier, so has no value even though it is below the strike. Right: Path ends below KI barrier.
</p>
</div>
</div>
<div id="cuo" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Call Up and Out</h3>
<p>In a <em>call up and out</em>, if the underlying is observed to breach a certain barrier X, the call is knocked out, it no longer exists. This means even if at maturity the underlying closing much higher than the strike, there is no payout.</p>
<p>Assuming the knock out barrier is X and strike is at the money, another way to see the value hierarchy is to say the <em>call up and out</em> is to a call spread ATM/X, what the call spread is to a vanilla call. While the call spread capped the upside to make it cheaper than the call, the <em>call up and out</em> removes the entire payoff when it reaches a certain barrier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">callK =<span class="st"> </span><span class="dv">1</span>
diffusions2y =<span class="st">  </span><span class="kw">aSampleSpotT_QMC</span>(<span class="dv">1</span>, <span class="fl">0.05</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">2</span>, <span class="dv">10000</span>)
payoffs2y =<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, diffusions2y -<span class="st"> </span>callK)
<span class="kw">cat</span>(<span class="st">&quot;Price of 2y atm call: &quot;</span>, <span class="kw">mean</span>(payoffs2y))</code></pre></div>
<pre><code>## Price of 2y atm call:  0.1780866</code></pre>
<p>Imagine an investor buys a 2y <em>call up &amp; out</em> with american daily close style knock out observation frequency on an underlying with 20% annualised volatility, drift = 5%. The investor should expect to pay much lesser for this than a 2y vanilla call on the same underlying.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">akoBarrier =<span class="st"> </span><span class="fl">1.4</span>
numTraj =<span class="st"> </span><span class="dv">20</span>
yrs =<span class="st"> </span><span class="dv">2</span>
numStepsDaily =<span class="st"> </span><span class="dv">252</span> <span class="co"># 2 years daily observation</span>
callTraj =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, numStepsDaily*yrs*numTraj), <span class="dt">nrow =</span> numTraj)
for (i in <span class="dv">2</span>:(numStepsDaily*yrs))
  callTraj[,i] =<span class="st"> </span><span class="kw">aSampleSpotT</span>(callTraj[,i<span class="dv">-1</span>], <span class="fl">0.05</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, yrs/(numStepsDaily*yrs), numTraj)

cuoTraj =<span class="st"> </span>callTraj
for (i in <span class="dv">1</span>:numTraj)
  for (j in <span class="dv">1</span>:(numStepsDaily*yrs))
    if (callTraj[i, j] &gt;<span class="st"> </span>akoBarrier) {
      cuoTraj[i, j:(numStepsDaily*yrs)] =<span class="st"> </span><span class="ot">NA</span>
      break;
    }</code></pre></div>
<div class="figure"><span id="fig:cuo-plot"></span>
<img src="bookdown-demo_files/figure-html/cuo-plot-1.png" alt="Left: Paths with knock out at 140%. Right: No knock out feature." width="672" />
<p class="caption">
Figure 3.3: Left: Paths with knock out at 140%. Right: No knock out feature.
</p>
</div>
</div>
<div id="combinations" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Combinations</h3>
<p>Using a combinations of call, put and digital options we could put together an exotic payoff that fits investor’s risk appetite.</p>
<p>For example, suppose an investor has a view that several underlyings will perform marginally well in the short term, but also thinks that there might be a slight chance of limited underperformance.</p>
<p>Since the investor holds a bullish view on a basket of underlyings, it is sensible to observe the entire basket but base the performance on the worst performing underlying.</p>
<p>We can therefore structure a payoff that pays an upside at maturity on the maximum of the worst-of call or a worst-of digit up and in. That is, <span class="math inline">\(Max( digit coupon, perf)\)</span>. If we set the digit strike to be at the money and the digit amount to be 10%, at maturity any marginal upside performance will pay 10% and may potentially lead to larger payouts if the performance exceeds 110%.</p>
<p>To finance this upside (nothing is free) the investor would have to sell a put. We would want to add protection on the short put by adding a european down and in barrier since we expect there to be a chance of underperformance.</p>
<table>
<caption><span id="tab:ben-correltab">Table 3.1: </span>3 correlated underlyings</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">undl1</th>
<th align="right">undl2</th>
<th align="right">undl3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>undl1</td>
<td align="right">1.0</td>
<td align="right">0.6</td>
<td align="right">0.6</td>
</tr>
<tr class="even">
<td>undl2</td>
<td align="right">0.6</td>
<td align="right">1.0</td>
<td align="right">0.6</td>
</tr>
<tr class="odd">
<td>undl3</td>
<td align="right">0.6</td>
<td align="right">0.6</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
<p>We assume there are 3 basket of underlyings with their returns well correlated, and all of them have constant annualised volatilities of 25%. Furthermore we assume their drifts are 1% per annum, that is <span class="math inline">\(r - d - q = 0.01\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
benUndls =<span class="st"> </span><span class="kw">nrow</span>(corr_ben)
benSteps =<span class="st"> </span><span class="dv">52</span> <span class="co"># weekly</span>
benTraj =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, benSteps*benUndls), <span class="dt">nrow =</span> benUndls)
for (i in <span class="dv">2</span>:benSteps)
  benTraj[,i] =<span class="st"> </span><span class="kw">corrSpot</span>(benTraj[,i<span class="dv">-1</span>], <span class="fl">0.03</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.25</span>, <span class="dv">1</span>/benSteps, corr_ben)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">benWoTraj =<span class="st"> </span><span class="kw">apply</span>(benTraj, <span class="dv">2</span>, min)
<span class="kw">tail</span>(benWoTraj, <span class="dv">1</span>) <span class="co"># worst performance at maturity</span></code></pre></div>
<pre><code>## [1] 0.9590089</code></pre>
<div class="figure"><span id="fig:benwo-traj-plot"></span>
<img src="bookdown-demo_files/figure-html/benwo-traj-plot-1.png" alt="A basket of 3 underlyings (in grey) and the worst-of underlying (in blue)" width="672" />
<p class="caption">
Figure 3.4: A basket of 3 underlyings (in grey) and the worst-of underlying (in blue)
</p>
</div>
<p>We see the worst performance at maturity is down around 4%. Because the worst performance did not end at or above the digit strike, there was no coupon paid. The call was also not in the money. However as a saving grace, the put had a knock-in protection and the barrier was not barrier since it required the worst performance to be below 80%.</p>
<p>For clarify we include the maturity payoff diagram.</p>
<div class="figure"><span id="fig:benwo-payoffdiag"></span>
<img src="bookdown-demo_files/figure-html/benwo-payoffdiag-1.png" alt="Payoff diagram of the product at maturity. Worst performance ended at 96%, above the protection barrier so no downside loss" width="672" />
<p class="caption">
Figure 3.5: Payoff diagram of the product at maturity. Worst performance ended at 96%, above the protection barrier so no downside loss
</p>
</div>
</div>
</div>
<div id="autocallable" class="section level2">
<h2><span class="header-section-number">3.2</span> Autocallable</h2>
<div id="apollon" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Snowball</h3>
</div>
<div id="phoenix" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Phoenix</h3>
</div>
<div id="fcn" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Fixed Coupons Notes</h3>
</div>
</div>
<div id="issuercallable" class="section level2">
<h2><span class="header-section-number">3.3</span> Issuercallable</h2>
<p>In Progress</p>
<p>Also see Chapter <a href="lsmc.html#lsmc">5</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="volsurf.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sensi.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
